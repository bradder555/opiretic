---
title: "The Dump"
date: 2025-04-10
---

# What's This?
This post is mostly an un-structured jumble of links, code snippets, and info I've found along the way.

I've had to dig to find the info I needed, and want to put it in one place i can come back to before i flesh it out. 

## The oPI Image where WiFi Works
Builtin wifi was a hard criteria, the only image i could find where it worked was at [sourceforge](Armbian_5.34_Orangepizero_Debian_stretch_next_4.13.13.img.7z)

## Burning
Used DD
Parted to resize the partition & create swap space

## Serial
Initially connected to the serial port using screen
``` sh
screen /dev/ttyUSB0 115200
```
## Armbian-config
Used the armbian config to configure the locale, hostname, wifi etc.

## APT Sources
Disabled the armbian cron jobs in /etc/cron.d/
Disabled the armbian source list in /etc/apt/sources.d/
Updated the sources in /etc/apt/sources.list to
``` text
deb http://archive.debian.org/debian stretch main contrib non-free
deb http://archive.debian.org/debian-security stretch/updates main
```
obviously updated everything

## Python
uv just installed and worked like magic, python 3.13
however, uvloop needed a bit of help going over the line

## FastAPI
Compiling uvloop consistently failed, used qemu in MSYS2 on windows to build there and transfer the compiled file back
[qemu install in msys2](https://www.qemu.org/download/#windows)
[qemu orange pi](https://www.qemu.org/docs/master/system/arm/orangepi.html#running-mainline-linux)
can't remember the exactl cli (can probably look it up)
had to resize the image to 2GB using the the qemu-resize cmd
can use console0 to interact but better to forward ssh

``` sh
-nic user,hostfwd=tcp:127.0.0.1:2222-:22 -nic net
```
increased the ram to the max allowed (1G) ``` -m 1G ```

The trick was install fastapi --extra standard 
https://docs.astral.sh/uv/guides/integration/fastapi/
when trying to run fastapi ``` uv run fastapi dev main.py ``` uvloop would attempt to compile
Would consistently crash on the orange pi, but compiled in qemu

once compiled in qemu, use sftp from the qemu vm to the sbc to move 
uvloop* from qemu ~/project_folder/.venv/lib/python/site-packages/uvloop*
after this fastapi ran fine

## Tailscale
[tailscale](https://login.tailscale.com/admin/machines)
tailscale is awesome makes connecting to the orange pi remotely super easy 

## User Control of GPIO
Many thanks to skematic at [in the armbian forum](https://forum.armbian.com/topic/8714-gpio-not-working-for-non-root)
set up the group with groupadd gpio
added the group to the user
restarted, user could then set the outputs

## Setting the outputs
Activate the output 
``` sh
# port 14
echo 14 > /sys/class/gpio/export
echo 1 > /sys/class/gpio/gpio14/active_low
echo "out" > /sys/class/gpio/gpio14/direction
echo 0 > /sys/class/gpio/gpio14/value
```
The above does the following:
- enables gpio port 14 (makes gpio14 appear)
- sets active is low, i.e. sinking the current, good for TTL stuff
- sets as output
- sets the value as off (i.e. relay is off), 1 would turn the relay on

# Todo
- Write the API
- Use yaml to record the configuration
- Use git to provide change history
- Either have a scheduled loop in the app or a script running on a cronjob, calls the API to get the current relay status, sets the output
- Build a sweet front-end in svelte 
